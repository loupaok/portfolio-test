---
/**
 * Main Menu Component
 * Auto-generated by PhantomWP Menu Builder
 * 
 * Mode: Auto-sync (pages are discovered automatically)
 * Usage: <MainMenu />
 */
import { getNavigationPages, isActivePath } from '../../lib/navigation';

const currentPath = Astro.url.pathname;
const discoveredPages = await getNavigationPages();
const excludedPages = [];

// Filter out excluded pages and build menu items
const menuItems = [
    // Home page
    { id: 'home', type: 'home' as const, label: 'Home', url: '/' },
    ...discoveredPages
        .filter(page => !excludedPages.includes(page.url))
        .map(page => ({
            id: 'page_' + page.slug,
            type: 'page' as const,
            label: page.title,
            url: page.url,
        })),
    // Custom links
    { id: 'item_1768817439610_twjp8ionw', type: 'custom' as const, label: 'Test 2', url: '/test-2' },
];
---

<!-- Desktop Navigation -->
<nav class="hidden md:flex items-center gap-1" aria-label="Main Menu">
    {menuItems.map((item) => (
        <a 
            href={item.url}
            class={`relative px-4 py-2 text-sm font-medium rounded-xl transition-all duration-300 no-underline cursor-pointer ${isActivePath(currentPath, item.url, item.url === '/') ? 'text-primary bg-primary/10' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
        >
            {item.label}
        </a>
    ))}
</nav>

<!-- Mobile Hamburger Button -->
<button
    type="button"
    class="md:hidden flex items-center justify-center w-10 h-10 text-content-light hover:text-content hover:bg-surface-alt rounded-xl transition-colors cursor-pointer"
    aria-label="Toggle menu"
    id="main-toggle"
>
    <svg class="w-6 h-6 hamburger-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
    </svg>
    <svg class="w-6 h-6 hidden close-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
</button>

<!-- Mobile Menu Panel -->
<div class="hidden md:hidden fixed inset-0 z-50" id="main-mobile">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="main-overlay"></div>
    <nav class="absolute top-0 right-0 w-80 max-w-[85vw] h-full bg-surface shadow-xl overflow-y-auto" aria-label="Main Menu mobile">
        <div class="p-4 border-b border-outline/50 flex items-center justify-between">
            <span class="font-semibold text-content">Main Menu</span>
            <button type="button" class="p-2 text-content-light hover:text-content rounded-lg cursor-pointer" id="main-close">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div class="p-4 space-y-1">
            {menuItems.map((item) => (
                <a 
                    href={item.url}
                    class={`block px-4 py-3 text-base font-medium rounded-xl transition-colors no-underline cursor-pointer ${isActivePath(currentPath, item.url, item.url === '/') ? 'text-primary bg-primary/10' : 'text-content-light hover:text-content hover:bg-surface-alt'}`}
                >
                    {item.label}
                </a>
            ))}
        </div>
    </nav>
</div>

<script>
    const toggle = document.getElementById('main-toggle');
    const mobile = document.getElementById('main-mobile');
    const overlay = document.getElementById('main-overlay');
    const close = document.getElementById('main-close');
    const hamburgerIcon = toggle?.querySelector('.hamburger-icon');
    const closeIcon = toggle?.querySelector('.close-icon');

    function openMenu() {
        mobile?.classList.remove('hidden');
        hamburgerIcon?.classList.add('hidden');
        closeIcon?.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
        mobile?.classList.add('hidden');
        hamburgerIcon?.classList.remove('hidden');
        closeIcon?.classList.add('hidden');
        document.body.style.overflow = '';
    }

    toggle?.addEventListener('click', () => mobile?.classList.contains('hidden') ? openMenu() : closeMenu());
    overlay?.addEventListener('click', closeMenu);
    close?.addEventListener('click', closeMenu);
    document.addEventListener('keydown', (e) => e.key === 'Escape' && !mobile?.classList.contains('hidden') && closeMenu());
</script>
