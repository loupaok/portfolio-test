---
import { getCustomPostType, getCustomPostTypeItem, getLocalFeaturedImageUrl, formatDate, rewriteContentUrls } from '../../lib/wordpress';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import FeaturedImage from '../../components/FeaturedImage.astro';

export async function getStaticPaths() {
  const items = await getCustomPostType('project');
  return items.map(item => ({
    params: { slug: item.slug },
  }));
}

const { slug } = Astro.params;
const item = await getCustomPostTypeItem('project', slug);

if (!item) {
  return Astro.redirect('/404');
}

const imageUrl = getLocalFeaturedImageUrl(item);
const content = rewriteContentUrls(item.content?.rendered || '');
---

<BaseLayout title={item.title?.rendered || 'Projects'}>
  <Header />
  <main class="container mx-auto px-4 py-8 max-w-[56rem] bg-surface">
    {imageUrl && (
      <FeaturedImage 
        src={imageUrl} 
        alt={item.title?.rendered}
        width={1200}
        height={630}
        class="w-full h-64 md:h-96 object-cover rounded-lg mb-8"
        priority={true}
      />
    )}
    
    <header class="mb-8">
      <h1 class="text-4xl font-bold mb-4 text-content" set:html={item.title?.rendered} />
      <time datetime={item.date} class="text-content/70">{formatDate(item.date)}</time>
    </header>
    
    <div class="prose prose-lg max-w-none" set:html={content} />
  </main>
  <Footer />
</BaseLayout>
